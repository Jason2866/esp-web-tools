<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <title>ESP Web Tools - Simple Test</title>
    <meta name="viewport" content="width=device-width" />
    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 600px;
        margin: 50px auto;
        padding: 20px;
      }
      h1 {
        color: #333;
      }
      .status {
        padding: 10px;
        margin: 20px 0;
        border-radius: 5px;
      }
      .loading {
        background: #fff3cd;
        border: 1px solid #ffc107;
      }
      .success {
        background: #d4edda;
        border: 1px solid #28a745;
      }
      .error {
        background: #f8d7da;
        border: 1px solid #dc3545;
      }
    </style>
  </head>
  <body>
    <h1>ESP Web Tools - Simple Test</h1>
    
    <div id="status" class="status loading">
      Loading ESP Web Tools...
    </div>

    <div id="button-container"></div>

    <div id="debug">
      <h3>Debug Info:</h3>
      <pre id="debug-info"></pre>
    </div>

    <script type="module">
      const statusDiv = document.getElementById('status');
      const buttonContainer = document.getElementById('button-container');
      const debugInfo = document.getElementById('debug-info');

      function log(msg) {
        console.log(msg);
        debugInfo.textContent += msg + '\n';
      }

      log('Starting...');
      log('Location: ' + window.location.href);
      log('Hostname: ' + window.location.hostname);

      // Check Web Serial support
      if ('serial' in navigator) {
        log('✓ Web Serial API is supported');
      } else {
        log('✗ Web Serial API is NOT supported');
        statusDiv.className = 'status error';
        statusDiv.textContent = 'Web Serial API not supported. Use Chrome or Edge.';
      }

      // Try to load ESP Web Tools
      const scriptPath = '/dist/web/install-button.js';
      log('Loading from: ' + scriptPath);

      try {
        const module = await import(scriptPath);
        log('✓ Module loaded successfully');
        log('Module exports: ' + Object.keys(module).join(', '));
        
        statusDiv.className = 'status success';
        statusDiv.textContent = 'ESP Web Tools loaded successfully!';

        // Create button
        buttonContainer.innerHTML = `
          <esp-web-install-button
            manifest="https://firmware.esphome.io/esphome-web/manifest.json"
          >
            <button slot="activate" style="
              background: #007bff;
              color: white;
              border: none;
              padding: 12px 24px;
              font-size: 16px;
              border-radius: 5px;
              cursor: pointer;
            ">
              Connect Device
            </button>
            <span slot="unsupported" style="color: red;">
              Web Serial not supported
            </span>
          </esp-web-install-button>
        `;
        
        log('✓ Button created');
      } catch (err) {
        log('✗ Error loading module: ' + err.message);
        log('Stack: ' + err.stack);
        statusDiv.className = 'status error';
        statusDiv.textContent = 'Failed to load ESP Web Tools: ' + err.message;
      }
    </script>
  </body>
</html>
